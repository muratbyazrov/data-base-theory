## DML: Вставка, обновление, удаление, выборка

[К оглавлению...](/README.md)

**Бэкап** - это точная копия базы на какой-то момент времени <br>
**Реплика** - это уже лучше, это копия базы, которая просто немного отстает от мастера

- Не хранить бэкап на том же сервере, что и сервер базы
- Бэкап можно и нужно делать автоматически
- Бэкап - это нагрузка на работающую систему

---

Термины

- **RTO** (Recovery Time Objective) - сколько времени нужно на восстановление резервной копии
- **RPO** (Recovery Point Objective) - точка во времени, на которую должны быть восстановлены данные
- **Backup Level** - уровень резервного копирования
    - 0 - **Full** - это полный бэкап. Postgres только его предоставляет. Другие нет
    - 1 - **Differential** - копируется только то, что изменилось с последнего полного (Full) копирования. Full +
      разница
    - 2 - **Incremental** - с последнего бэкапа (любого из этих трех)
- **Глубина резервного копирования** - как долго хранить копии

<img src='./images/29.png' width=500 height=250>

---

Виды бэкапов

- Логическое
    - Нельзя создавать с определенной точки во времени
    - Можно сделать копию отдельного объекта
    - Можно восстановиться на другой версии postgres
    - Можно восстановиться на другой архитектуре
    - Низкая скорость
    - Делается легко с помощью запроса. Сохраняется в файл. Смотри гугл
    - В общем, тут более гибкие возможности восстановления и переноса данных

Методы создание логического бэкапа

1. **pg_dump** - создается текстовый файл с SQL командами для создания и вставки данных

```bash
pg_dump -h host -U username -d dbname -f backup.sql
```

Надо учитывать, что когда начинает создаваться бэкап, в нее не попадают данные, которые появились после начала процесса
создания бэкапа <br>
Бэкап можно создавать с доп опциями (сжатие, параллельное выполнение и т.д.) - погуглить, если надо

```shell
pg_dump -h host -U username -Fc -f backup.custom dbname
```

2. **pg_dumpall** - то же самое, что **pg_dump** только для всех баз данных в кластере

```bash
pg_dumpall -h host -U username -f backup.sql
```

3. **logical replication** - логическая репликация в postgres позволяет передавать изменения между базами данных, что
   можно считать неявным способом создания логического бэкапа

- Физическое
    - Можно создавать с определенной точки во времени
    - Высокая скорость относительно логического вида
    - Нельзя восстановить отдельную базу, только весь кластер
    - делается с помощью утилиты **pg_basebackup** - подробности гуглить

Виды физического бэкапа:

- Холодное - когда БД остановлена
- Горячее - на работающей базе (чаще всего вот это будет использоваться) - погуглить, как делать правильно

---

остановился на 1.24 минуте. Надо чатГПТ спросить про последоватьельность создания физического бекапа
