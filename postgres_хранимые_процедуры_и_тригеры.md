## Хранимые процедуры и Тригеры

[К оглавлению...](/README.md)

Плюсы хранимых процедур (по сути бизнес логики в базе)

- Скорость
- Нет трафика между бд и сервисом
- Безопасность (не светим данными)
- Процедуры жестко связаны со структурой данных - соотв. меньше ошибок

#### Выполнение кода без определения функции или процедуры (так можно только в pg после 11 версии):

```sql
DO $$ BEGIN
    /*тут будет код*/ 
END $$;
```

```sql
DO $$ 
DECLARE 
    /*тут будут объявлены переменны*/ 
BEGIN 
    /*тут будет код*/ 
END $$;
```

- Можно перехватывать ошибки (`EXCEPTION WHEN OTHERS THEN`)
- Можно писать на SQL, или других языках, например Питон или даже JS, но нужны расширения и так же учитывать время на
  ретрансляцию кода
- Можно указать параметры создания, такие как режимы аргумента, права пользователя и другие

#### Функции и процедуры

Синтаксис:
```sql
CREATE OR REPLACE FUNCTION имя_функции()
RETURNS тип_результата AS
$$
DECLARE
    -- объявление переменных
BEGIN
    -- тело функции
    -- ваши SQL-запросы и логика
END;
$$
LANGUAGE plpgsql;
```

- Можно вернуть результат структурой таблицы: `...RETURNS SETOF <table_name> AS...`

// остановился на 27 минуте