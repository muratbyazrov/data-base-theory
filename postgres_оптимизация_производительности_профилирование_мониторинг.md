## Оптимизация производительности. Профилирование. Мониторинг.

[К оглавлению...](/README.md)

Анализ БД
Почему тупит?
 - ресурсы проверить (cpu, ram, disk)
 - посмотреть долгие запросы
 - посмотреть индексы
 - `vacuum analise` (postgres анализирует данные, после чего планировщик строит более оптимальные запросы)
 - `explain` тупящих запросов
 - посмотреть последние миграции и последние commit-ы
 - найти самый большой запрос и убить если можно (`pg_stat_activity`)
   - загуглить как найти, как убить
 - коннекты в состоянии `idle` (запрос выполнен, но коннект висит) - если больше 100 (по умолчанию) - то пздц
   - хуже всего состояние `idle in transactions` - запрос висит и ожидает выполнения другого запроса (блокировка)
 - снять повисшие транзакции (влияет на анализатор, wall файлы и др...)
 - `pg_stat_statements` - можно посмотреть уже выполненные долгие запросы

Дополнительно
- Postgres очень не любит windows и любит linux (файловая система не оптимальна, доступ к ядру ОС)
- `WALL` файлы лучше хранить на отдельных дисках
- если загрузка cpu больше 70 процентов и ядра загружены равномерно - значит не хватает ресурсов
- загуглить про hugo pages
- загуглить про transparent hugo page
- `swappiness` - когда не хватает RAM (оперативки), система начинает лезть в диски (они медленнее, чем RAM)
  - частота сброса данных из RAM в SWAP - рекомендуется от 1 до 5
- иметь grafana + prometheus

ОСТАНОВИЛСЯ НА 48 МИНУТЕ
