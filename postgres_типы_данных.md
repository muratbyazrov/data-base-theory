## Типы данных

[К оглавлению...](/README.md)

-- просмотр возможных типов данных

```sql
SELCT * FROM pg_type
```

Есть базовые типы (type = 'b') и всякие доп типы ещё есть

Тип serial начинается с 1, а не с отрицательного числа, как просто int/bigint
(serial - это синтаксический сахар - под капотом CREATE SEQUENCE...)

CREATE SEQUENCE... удобно использовать, когда есть две таблицы и есть необходимость, чтобы их первичные ключи никогда не
пересекались. В таком случае, можно им задать один и тои же SEQUENCE

В SEQUENCE можно настраивать шаг, максимальное и минимальное значения, а так же цикл (чтобы сбрасывать, когда достигли
максимума)

SEQUENCE устарел в pg. Identity - вместо него. В чем разница между SEQUENCE и Identity? - Identity привязан к конкретной
таблице и полю, он не имеет имени, его нельзя переиспользовать.

```sql
CREATE TABLE test_new (
    id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    payload text
);
```

### Вещественные типы

- есть с указанной точностью (decimal, numeric)
- без указанной точности (real, double precision)

Numeric можно задавать как numeric(n, m) гле n - всего цифр, m - цифр после запятой. Можно не указывать ничего - тогда
будет максимальный numeric

### Округление

В пг есть округление

- ceil
- floor
- round
- trunc

округление вещественных типов работает по-разному для разных типов, поэтому быть внимательнее

### Математические операторы

- можно возводить в степень, брать корень (квадратный, кубический)

### boolean

- занимает байт
- три значения: true, false, null

### Символьные типы

- character varying(n), varchar(n) - строка ограниченной переменной длины
- character(n), char(n) - строка фиксированной длины с пробелами
- text - любая длина

В постгре есть много функций со строками (можно например переводить первые буквы в верхний регистр)

### Время и дата

Есть много типов, есть даже микросекунда

Есть стили, стили можно менять

- ISO
- SQL
- Postgres
- German

`select current_date `- можно узнать текущую дату

Eсть куча функций с датами

### тип interval

- для хранения разницы между двумя датами, а так же для операций сложения, вычитания из дат, например

```sql
-- вот это сохраниится в поле с типом interval
SELECT TIMESTAMP '2023-06-01 12:00:00' - TIMESTAMP '2023-05-30 10:00:00' AS duration;

-- вот тут к дате можно добавить какой-то интервал, что удобнее, чем делать это в js к примеру
SELECT TIMESTAMP '2023-06-01 12:00:00' + INTERVAL '1 day 2 hours' AS new_timestamp;
```

### Массивы

- Postgres, кроме обычных массивов поддерживает многомерные массивы (`text[][]`) только массив может быть только
  квадратным

Так же есть функции над массивами:

- можно посчитать размер массива
- операторы ANY, ALL
- можно взять конкретный элемент массива по индексу
- так же есть поиск с условием where

### UUID

- по умолчанию генерится с помощью функции gen_random_uuid()
- можно генерить другими алгоритмами, если надо
- он дает большее количество уникальных значений, чем bigint + поможет, если распределенная база, а так лучше
  использовать bigint

### JSON

- разница между JSON и JSONB (бинарный json) в том, что последний поддерживает индексацию!
- json сохраняет фактический точную копию данных (вместе с пробелами и прочей фигней)
- есть функции для json
- можно брать какой-то элемент типа `->`, `->>` и так далее

### Диапазон

- Можно создать диапазон (числовые или по времени, или других типов), а потом
  - можно проверить, входит ли конкретное значение в диапазон
  - искать по диапазону
  - объединять диапазоны
  - находить их разность
  - находить пересечения

### Домены

- с помощью доменов (ограничений) можно ограничивать поля (например, возраст не может быть более 200 лет и не может быть
  отрицательным)
- надо иметь в виду, что ограничения имеют свою цену в скорости вставки
